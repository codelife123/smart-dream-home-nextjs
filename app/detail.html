<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <header class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="home.html#products" class="text-green-700 font-bold">‚Üê Back to products</a>
    <a href="home.html" class="bg-white px-3 py-2 rounded-lg shadow">Smart Dream Home</a>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-6">
    <div id="content" class="bg-white rounded-2xl shadow p-6">
      <div id="loading" class="text-center text-gray-600">Loading product...</div>
      <div id="detail" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6">
        <img id="prodImg" src="" alt="" class="w-full h-64 object-cover rounded-lg">
        <div>
          <h1 id="prodName" class="text-2xl font-bold mb-2"></h1>
          <p id="prodPrice" class="text-green-600 font-semibold mb-3"></p>
          <p id="prodDesc" class="text-gray-700 mb-4"></p>

          <div id="variantWrap" class="mb-4 hidden">
            <label class="block text-sm font-medium mb-1">Variant</label>
            <select id="variantSelect" class="border p-2 rounded w-full"></select>
          </div>

          <div class="flex items-center gap-3 mb-4">
            <label class="text-sm">Qty:</label>
            <input id="qty" type="number" min="1" value="1" class="w-24 p-2 border rounded">
          </div>

          <div class="flex gap-3">
            <button id="addToCart" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">üõí Add to Cart</button>
            <a id="openWhatsapp" class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300" target="_blank">Enquiry via WhatsApp</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Long Description Section -->
    <div id="longDesc" class="mt-6 bg-white rounded-2xl shadow p-6 hidden">
      <!-- Filled dynamically: video (if any), EN description, SI description -->
    </div>
  </main>

  <script>
  // Minimal product dataset: mirrors attributes from home.html cards
  const PRODUCTS = [
    { id:'p1', name:'Smart Touch Panel Switch', img:'https://i.postimg.cc/k41VSJK6/modern-living-room-interior-with-large-tv-screen-displaying-home-automation-system-1.jpg', desc:'Smart touch panel switch with WiFi, app scheduling, voice control and elegant finish. 12 months warranty.', variants:[{label:'1 Gang', price:2999},{label:'2 Gang', price:3399},{label:'3 Gang', price:3799},{label:'4 Gang', price:3999}] },
    { id:'p2', name:'Smart Push Button Switch', img:'https://i.postimg.cc/PrFBRBz2/Stock-Cake-Smart-Home-Control-1759310190.jpg', desc:'Push-button smart switch with relay, WiFi control and LED indicator. 12 months warranty.', variants:[{label:'1 Gang', price:2999},{label:'2 Gang', price:3399},{label:'3 Gang', price:3799},{label:'4 Gang', price:3999}] },
    { id:'p3', name:'Smart MCB', img:'https://i.postimg.cc/fbxWZw8s/neon-robot-vacuum-cleaner-1.jpg', desc:'Smart MCB with remote trip alerts, current monitoring and overload protection. 18 months warranty.', price:6000 },
    { id:'p4', name:'Smart RCCB', img:'https://i.postimg.cc/3w962VRB/Stock-Cake-Nature-meets-technology-1759310604.jpg', desc:'Earth leakage (RCCB) with smart notifications and test. 18 months warranty.', price:8500 },
    { id:'p5', name:'Moes Smart Door Lock', img:'https://i.postimg.cc/PrFBRBz2/Stock-Cake-Smart-Home-Control-1759310190.jpg', desc:'Moes smart door lock: fingerprint, PIN, card, app access, logs, backup keys. 24 months warranty.', price:42000 },
    { id:'p6', name:'Smart IR Control', img:'https://i.postimg.cc/fbxWZw8s/neon-robot-vacuum-cleaner-1.jpg', desc:'Universal IR controller for AC/TV/set-top boxes ‚Äî add IR devices to your smart home.', price:2500 },
    { id:'p7', name:'Smart Socket', img:'https://i.postimg.cc/k41VSJK6/modern-living-room-interior-with-large-tv-screen-displaying-home-automation-system-1.jpg', desc:'Smart socket with power monitoring and remote on/off control.', price:2800 },
    { id:'p8', name:'Smart Socket Base', img:'https://i.postimg.cc/3w962VRB/Stock-Cake-Nature-meets-technology-1759310604.jpg', desc:'Smart socket base that supports different plugs, scheduling & remote control.', price:4800 },
    { id:'p9', name:'Moes Smart Fan Controller', img:'https://i.postimg.cc/fbxWZw8s/neon-robot-vacuum-cleaner-1.jpg', desc:'Moes fan controller with speed presets, remote and app control.', price:5500 },
    { id:'p10', name:'Smart Soil Tester Sensor', img:'https://i.postimg.cc/k41VSJK6/modern-living-room-interior-with-large-tv-screen-displaying-home-automation-system-1.jpg', desc:'Soil moisture & nutrient sensor with app alerts ‚Äî ideal for smart gardening.', price:4800 },
    { id:'p11', name:'Smart Valve', img:'https://i.postimg.cc/3w962VRB/Stock-Cake-Nature-meets-technology-1759310604.jpg', desc:'Motorized smart valve for irrigation ‚Äî schedule and control remotely.', price:7800 },
    { id:'p12', name:'Smart Mini Switch', img:'https://i.postimg.cc/PrFBRBz2/Stock-Cake-Smart-Home-Control-1759310190.jpg', desc:'Mini smart switch 16A ‚Äî WiFi + Tuya support, voice control, energy monitoring.', price:1600 },
    { id:'p13', name:'Smart Garage Controller', img:'https://i.postimg.cc/fbxWZw8s/neon-robot-vacuum-cleaner-1.jpg', desc:'Smart garage controller to open/close doors remotely with safety sensors.', price:5500 },
    { id:'p14', name:'Intelligent Light Control System', img:'https://i.postimg.cc/k41VSJK6/modern-living-room-interior-with-large-tv-screen-displaying-home-automation-system-1.jpg', desc:'Full intelligent lighting control with scenes, dimming, presence detection and remote management.', price:14500 }
  ];

  const params = new URLSearchParams(location.search);
  const id = params.get('id');

  const loading = document.getElementById('loading');
  const detail = document.getElementById('detail');
  const prodImg = document.getElementById('prodImg');
  const prodName = document.getElementById('prodName');
  const prodPrice = document.getElementById('prodPrice');
  const prodDesc = document.getElementById('prodDesc');
  const variantWrap = document.getElementById('variantWrap');
  const variantSelect = document.getElementById('variantSelect');
  const qtyInput = document.getElementById('qty');
  const addToCartBtn = document.getElementById('addToCart');
  const openWhatsapp = document.getElementById('openWhatsapp');

  if(!id){
    loading.textContent = 'Product not found.';
  } else {
    let product = null;
    try {
      const cached = sessionStorage.getItem('sdh_selected_product');
      if(cached){
        const parsed = JSON.parse(cached);
        if(parsed && parsed.id === id){ product = parsed; }
      }
    } catch(_) {}
    if(!product){ product = PRODUCTS.find(p=>p.id===id); }
    if(!product){
      loading.textContent = 'Product not found.';
    } else {
      loading.classList.add('hidden');
      detail.classList.remove('hidden');
      const primaryImg = (product.images && product.images[0]) || product.img || '';
      prodImg.src = primaryImg;
      prodName.textContent = product.name;
      prodDesc.textContent = product.desc || product.description_en || product.description_si || '';

      let selectedPrice = 0;
      let selectedVariantLabel = '';
      if(Array.isArray(product.variants) && product.variants.length){
        variantWrap.classList.remove('hidden');
        variantSelect.innerHTML = '';
        product.variants.forEach(v=>{
          const o = document.createElement('option');
          o.value = JSON.stringify(v);
          o.text = `${v.label} ‚Äî Rs. ${Number(v.price).toLocaleString()}`;
          variantSelect.appendChild(o);
        });
        const v = JSON.parse(variantSelect.value);
        selectedPrice = Number(v.price);
        selectedVariantLabel = v.label;
        prodPrice.textContent = `Rs. ${selectedPrice.toLocaleString()} (${selectedVariantLabel})`;
        variantSelect.addEventListener('change', ()=>{
          const v = JSON.parse(variantSelect.value);
          selectedPrice = Number(v.price);
          selectedVariantLabel = v.label;
          prodPrice.textContent = `Rs. ${selectedPrice.toLocaleString()} (${selectedVariantLabel})`;
        });
      } else {
        selectedPrice = Number(product.price || 0);
        prodPrice.textContent = selectedPrice ? `Rs. ${selectedPrice.toLocaleString()}` : 'Contact for price';
      }

      function loadCart(){ try{ return JSON.parse(localStorage.getItem('sdh_cart_v1')) || []; }catch(e){ return []; } }
      function saveCart(cart){ localStorage.setItem('sdh_cart_v1', JSON.stringify(cart)); }

      addToCartBtn.addEventListener('click', ()=>{
        const qty = Math.max(1, Number(qtyInput.value) || 1);
        const cart = loadCart();
        const key = `${product.id}-${selectedVariantLabel}`;
        const existing = cart.find(c=>c.key===key);
        if(existing){ existing.qty += qty; }
        else { cart.push({ key, id: product.id, name: product.name, variant: selectedVariantLabel, price: selectedPrice, qty }); }
        saveCart(cart);
        alert('Added to cart');
      });

      const waMsg = encodeURIComponent(`Hello, I am interested in ${product.name}${selectedVariantLabel? ' ('+selectedVariantLabel+')':''}.`);
      openWhatsapp.href = `https://wa.me/94764511276?text=${waMsg}`;

      // Long description rendering
      const longDesc = document.getElementById('longDesc');
      const descEn = product.description_en || '';
      const descSi = product.description_si || '';
      const yt = product.youtubevideo || product.youtubeVideo || '';

      function getYouTubeEmbedUrl(url){
        if(!url) return '';
        try {
          // Accept full urls like https://www.youtube.com/watch?v=ID or youtu.be/ID or already embed
          if(url.includes('/embed/')) return url;
          const u = new URL(url);
          if(u.hostname.includes('youtu.be')){ return `https://www.youtube.com/embed/${u.pathname.replace('/', '')}`; }
          const v = u.searchParams.get('v');
          if(v) return `https://www.youtube.com/embed/${v}`;
          return url; // fallback
        } catch(_){ return url; }
      }

      let html = '';
      if(yt){
        const embed = getYouTubeEmbedUrl(yt);
        html += `
          <div class="mb-6">
            <div class="relative" style="padding-bottom:56.25%; height:0; overflow:hidden; border-radius:12px;">
              <iframe src="${embed}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position:absolute; top:0; left:0; width:100%; height:100%;"></iframe>
            </div>
          </div>
        `;
      }
      if(descEn){
        html += `<div class="prose max-w-none mb-6"><h2 class="text-xl font-bold mb-2">Description </h2><p class="whitespace-pre-line text-gray-800">${descEn}</p></div>`;
      }
      if(descSi){
        html += `<div class="prose max-w-none"><h2 class="text-xl font-bold mb-2">‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫</h2><p class="whitespace-pre-line text-gray-800">${descSi}</p></div>`;
      }
      if(html){ longDesc.innerHTML = html; longDesc.classList.remove('hidden'); }
    }
  }
  </script>

  </body>
  </html>


